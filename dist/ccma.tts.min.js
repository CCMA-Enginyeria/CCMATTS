!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("_"),require("Backbone"),require("jQuery")):"function"==typeof define&&define.amd?define(["_","Backbone","jQuery"],t):"object"==typeof exports?exports.CCMATTS=t(require("_"),require("Backbone"),require("jQuery")):e.CCMATTS=t(e._,e.Backbone,e.jQuery)}(window,(function(e,t,i){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(t,i){t.exports=e},function(e,i){e.exports=t},function(e,t){e.exports=i},function(e,t,i){"use strict";i.r(t);var n=i(0),o=i.n(n),s=i(2),r=i.n(s),a=i(1),u=i.n(a);const l=u.a.Model.extend({defaults:{titol_bloc:null,titol:null,audio_buffer:[],isPlaying:!1,isCancellable:!0,speed:"normal",speedToPlay:"normal"},initialize:function(e,t){u.a.Model.prototype.initialize.apply(this,arguments),this.audioBuffer=[],this.mapDies=this.getMapDies(),this.mapCanals=this.getMapCanals(),this.listenTo(this,"change:isPlaying",o.a.bind(this.onPlayingChange,this)),this.changeAudioDebounced=o.a.debounce(this.changeAudio,500)},doBeep:function(){this.trigger("onBeep")},push:function(e,t){var i={titol_bloc:e.titleSection,titol:e.title,options:e};this.audioBuffer.push(i),"intro"===e.id?this.changeAudio():t||this.changeAudioDebounced()},onPlayingChange:function(){!1===this.get("isPlaying")&&this.audioBuffer.length>0&&this.changeAudioDebounced()},changeAudio:function(){if((!this.get("isPlaying")||this.get("isCancellable"))&&(this.audioBuffer.length>1||!this._hasRenderPage())){if(this.orderedAudioBuffer=this._getOrderedAudioBuffer(),this._checkBeep())return void this.doBeep();var e=this.get("titol_bloc"),t="",i=[];i=o.a.map(this.orderedAudioBuffer,o.a.bind((function(i){return i=this._beautifyTTSElement(i),t="",null!==i.titol_bloc&&i.titol_bloc!==e&&(e=i.titol_bloc,t+=i.titol_bloc+". "),t+=i.titol+". "}),this)),this.set({audio_buffer:i,titol_bloc:e,titol:i.join(""),isCancellable:this._isCancellable(this.orderedAudioBuffer)}),this.audioBuffer=[]}},getAudios:function(){return this.get("audio_buffer")},resetAudios:function(){this.set({audio_buffer:[]})},getCatchup:function(e){var t=e.split(" "),i="";return 2===t.length?this.mapCanals[t[1]].canal:("undefined"===t[2]?i+=this.mapDies[t[1]].dia+" ":i+=this.mapDies[t[1]].dia+" "+t[2]+" ",t.length>3&&(i+=this.mapCanals[t[3]].canal),i)},getMapDies:function(){var e={DL:{dia:"Dilluns"},DT:{dia:"Dimarts"},DM:{dia:"Dimecres"},DJ:{dia:"Dijous"},DV:{dia:"Divendres"},DS:{dia:"Dissabte"},DG:{dia:"Diumenge"},AVUI:{dia:"AVUI"},AHIR:{dia:"AHIR"}};return e},getMapCanals:function(){var e={tv3:{canal:"tv3"},324:{canal:"3 24"},cs3:{canal:"super 3"},"33d":{canal:"33"},es3:{canal:"esport 3"}};return e},_getWhiteListData:function(){this.whitelist=WhitelistModel.getInstance(),this.listenTo(this.whitelist,"sync",this.onWhiteListChange),this.onWhiteListChange()},_hasRenderPage:function(){return o.a.filter(this.audioBuffer,(function(e){return"renderPage"===e.options.id})).length>0},_checkBeep:function(){return!!this._hasBeep()&&!(o.a.filter(this.orderedAudioBuffer,(function(e){return"renderResults"===e.options.id})).length>0)},_hasBeep:function(){var e,t=o.a.filter(this.orderedAudioBuffer,(function(e){return e.titol.indexOf("_beep")>=0}));for(e=0;e<t.length;e+=1)this.orderedAudioBuffer=o.a.without(this.orderedAudioBuffer,t[e]),this.audioBuffer=o.a.without(this.audioBuffer,t[e]);return t.length>0},_isCancellable:function(e){return!(o.a.filter(e,(function(e){return!1===e.options.cancellable})).length>0)},_getOrderedAudioBuffer:function(){var e=o.a.reduce(this.audioBuffer.reverse(),(function(e,t,i,n){return e[t.options.id]=e[t.options.id]||t,e[t.options.id].options.priority<t.options.priority&&(e[t.options.id]=t),e}),{});return o.a.sortBy(o.a.values(e),(function(e){return-e.options.priority}))},_beautifyTTSElement:function(e){switch(e.options.beautifier){case"catchup":return{titol:this.getCatchup(e.titol),titol_bloc:e.titol_bloc};case"catchup_titol_bloc":return{titol:e.titol,titol_bloc:this.getCatchup(e.titol_bloc)};default:return e.titol_bloc,{titol:e.titol,titol_bloc:e.titol_bloc}}},_getTitle:function(){return this._getAccessibleText(this.$el)},_getBlockTitle:function(){var e=this.$el.parents("[aria-label],[aria-labelledby]");return e.length?this._getAccessibleText(e.eq(0)):"SENSE TITOL"}},{singleton:null,getInstance:function(){return l.singleton=l.singleton||new l,l.singleton}});var c=l;const h=u.a.Model.extend({defaults:{titleSection:null,title:"No és un element DÓM HTML ",cancellable:!1,priority:10,id:"normal",beautifier:"normal",speed:"normal"},initialize:function(e,t){u.a.Model.prototype.initialize.apply(this,arguments),this.textToSpeech=c.getInstance()},getDefaultConfig:function(){return this.toJSON()},getConfigFromElementWithSection:function(e){return e=r()(e),this._setOptions(e),this.set({title:this._setTitle(e),titleSection:this._setTitleSection(e)}),"_beep"===this.get("title")&&this._getBeepOptions(),this.toJSON()},getConfigFromElement:function(e){return e=r()(e),this._setOptions(e),this.set({title:this._setTitle(e),titleSection:null}),"_beep"===this.get("title")&&this._getBeepOptions(),this.toJSON()},_getBeepOptions:function(){this.set({cancellable:!1,priority:-1,id:"normal",beautifier:"normal",titleSection:null})},_setOptions:function(e){this.textToSpeech.set({speedToPlay:e.data("texttospeech-speed")?e.data("texttospeech-speed"):this.textToSpeech.get("speed")}),this.set({cancellable:e.data("texttospeech-cancellable"),priority:e.data("texttospeech-priority")||0,id:e.data("texttospeech-id")||"normal",beautifier:e.data("texttospeech-beautifier")||"normal"})},_setTitle:function(e){return this._getAccessibleText(e)},_setTitleSection:function(e){var t=e.parents("[aria-label],[aria-labelledby]");return t.length?this._getAccessibleText(t.eq(0)):"SENSE TITOL"},_getAccessibleText:function(e){var t,i,n=e.attr("aria-label");return n||((t=e.attr("aria-labelledby"))?(i=r()("#"+t)).length>0?this._getText(i):void 0:this._getText(e))},_getText:function(e){var t,i,n="";if(e.attr("aria-hidden")){if("true"===e.attr("aria-hidden"))return n}else if(0===e.children().length)return n+=e.text()+" ";for(i=e.contents(),t=0;t<i.length;t+=1)i.eq(t).nodeType===Node.TEXT_NODE?n+=" "+i.eq(t).text():n+=" "+this._getText(i.eq(t));return n.trim()}},{getInstance:function(){return new h}});var d=h;const f=u.a.Model.extend({defaults:{audios:null,audioSrc:null,speed:"4",isPlaying:!1,bufferLenght:800},initialize:function(e,t){this.textToSpeech=c.getInstance(),this.listenTo(this.textToSpeech,"change:titol change:active",this.onModelChange),this.listenTo(this.textToSpeech,"onBeep",this.onBeep),this.listenTo(this,"change:audioSrc",this.onAudioURLChange),this.listenTo(this,"change:isPlaying",this.onIsPlayingChange),this.listenTo(this.textToSpeech,"change:speedToPlay change:speed",this.changeVelocitat),this.onAudioFinished=o.a.bind(this.onAudioFinished,this),this.onModelChange(),this.changeVelocitat()},onIsPlayingChange:function(){this.textToSpeech.set({isPlaying:this.get("isPlaying")})},onAudioFinished:function(){this.audioQueue&&0!==this.audioQueue.length?this.set({text:this.audioQueue.shift()}):(this.set({isPlaying:!1}),this.textToSpeech.set({isCancellable:!0}))},onBeep:function(){var e=this.textToSpeech.getAudios();console.log("onBeep"),this.set({audios:e,text:"#beep"+Math.floor(1e3*Math.random()+1)})},changeVelocitat:function(){var e=this.textToSpeech.get("speedToPlay");e&&"null"!==e?this.set({speed:this._getMapSpeed()[e].speed}):this.set({speed:this._getMapSpeed().normal.speed})},onModelChange:function(){var e=this.textToSpeech.getAudios();this.set({audios:e,text:this._getAudioSentence(e),isPlaying:!0})},_getMapSpeed:function(){var e={normal:{speed:"4"},slow:{speed:"1"},fast:{speed:"7"}};return e},_getAudioSentence:function(e){if(console.log(e),this.audioQueue=[],0===e.length)return null;var t=o.a.reduce(e,(function(e,t){return e+=t+". "}),"");return t.length>this.get("bufferLenght")?(this._getAudioQueue(t),this.audioQueue.shift()):t},_getAudioQueue:function(e){var t=e.split(".");this.audioQueue=o.a.reduce(t,o.a.bind((function(e,t){return t=t.trim()+".",0===e.length||(e[e.length-1]+t).length>this.get("bufferLenght")?e.push(t):e[e.length-1]+=t,e}),this),[])}},{singleton:null,getInstance:function(){return f.singleton=f.singleton||new f,f.singleton}});var g=f;i.d(t,"pushAudioConfig",(function(){return _})),i.d(t,"getTTSConfigFromElement",(function(){return S})),i.d(t,"onAudioURLChange",(function(){return y})),i.d(t,"offAudioURLChange",(function(){return x})),i.d(t,"setSpeed",(function(){return m})),i.d(t,"setAudioServiceURLFactory",(function(){return A}));const p=g.getInstance();let b;function _(e){var t=c.getInstance();e?t.push(e):t.push(S())}let T=[];function y(e){T.push(e)}function x(e){T.splice(T.indexOf(e))}function S(e,t){var i=d.getInstance();return e&&e instanceof HTMLElement?t?i.getConfigFromElementWithSection(e):i.getConfigFromElement(e):i.getDefaultConfig()}function m(e){var t=c.getInstance();e&&t.set({speed:e})}function A(e){b=e}p.on("change:text",(function(){var e=b({text:p.get("text"),speed:p.get("speed")});o.a.each(T,(function(t){t({url:e,onAudioFinished:p.onAudioFinished})}))}))}])}));